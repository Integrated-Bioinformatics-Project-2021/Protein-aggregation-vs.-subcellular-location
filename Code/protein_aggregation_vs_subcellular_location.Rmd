---
title: "Protein_aggregation_vs_subcellular_location"
output:
  pdf_document: default
  html_notebook: default
---

<!-- This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.  -->

<!-- Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.  -->

<!-- Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*. -->

<!-- When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file). -->

<!-- The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed. -->

# Initialization

## Install all the needed libraries.

```{r}
#install.packages("UniprotR")
#install.packages("BiocManager")
#BiocManager::install("Biostrings")
#BiocManager::install("GenomicAlignments")
#install.packages("sjmisc")
#install.packages("hash")
#install.packages("dplyr")
#install.packages("Peptides")
#install.packages("dgof")
#install.packages("igraph")
#install.packages("ggpubr")
#install.packages("gtools")

```

## Load the needed libraries.

```{r}
library(UniprotR)
library(sjmisc) # Used for str_contains
library(hash) # Used to make a dictionary
library(dplyr) # Used for aggregate (get avg tango score of protein)
library(Peptides) # Used for charge (get the charge of a peptide sequence) ETC
library(ggplot2)
library(dplyr)
library(ggrepel)
library(tidyverse)
```

## Define the working directory.

```{r}
directory = dirname(rstudioapi::getSourceEditorContext()$path) # Place the data in a Data folder on the path of this file
setwd(directory)
```

## Load the data.

```{r}
source("load_data.R")
return_value = read_data() # See load_data.R
data = return_value$data
hashed_proteins = return_value$hashed_proteins
rm(return_value) # To get rid of the extra memory usage
```

## Exploratory analysis
```{r}
source("co_occurence.R")
plot_co_occurence(relative = FALSE)
plot_co_occurence(relative = TRUE)
```

# TANGO scores

```{r}
source("tango_scores.R")
```

## Average tango score distribution in all proteins

##Statistical tests and visualisation for subcellular location
```{r}
plot_average_tango_scores_complete_proteins()
significance_subcellular(tango_scores_complete_protein)
get_krustal_test_results(tango_scores_complete_protein)
get_wilcox_test_table(tango_scores_complete_protein)
plot_stat_significance(tango_scores_complete_protein)
```
##Statistical tests and visualisation on secretory vs. non-secretory 
```{r}
#plot_average_tango_scores_complete_proteins_joined_secreted()
significance_secretory(tango_scores_complete_protein)
plot_stat_significance_secretory(tango_scores_complete_protein)
```



## Average tango score distribution in proteins with an APR region

##Statistical tests and visualisation for subcellular location
```{r}
plot_average_tango_scores_APR_proteins()
significance_subcellular(tango_scores_APR_protein)
get_krustal_test_results(tango_scores_APR_protein)
get_wilcox_test_table(tango_scores_APR_protein)
plot_stat_significance(tango_scores_APR_protein)
```

##Statistical tests and visualisation on secretory vs. non-secretory 
```{r}
#plot_average_tango_scores_APR_proteins_joined_secreted()
significance_secretory(tango_scores_APR_protein)
plot_stat_significance_secretory(tango_scores_APR_protein)
```

## Distribution of maximal tango scores

##Statistical tests and visualisation for subcellular location
```{r}
plot_max_tango_scores()
significance_subcellular(max_tango_scores)
get_krustal_test_results(max_tango_scores)
get_wilcox_test_table(max_tango_scores)
plot_stat_significance(max_tango_scores)
```
##Statistical tests and visualisation on secretory vs. non-secretory
```{r}
significance_secretory(max_tango_scores)
plot_stat_significance_secretory(max_tango_scores)
```


## Distribution of number of APR regions per protein normalized for protein length

##Statistical tests and visualisation for subcellular location
```{r}
#plot_average_tango_scores_complete_proteins() # Should be: plot_normalized_number_APR_regions()
#significance_subcellular_nbAPR(normalized_number_APR_regions)
#get_krustal_test_results_nbAPR(normalized_number_APR_regions)
#get_wilcox_test_table_nbAPR(normalized_number_APR_regions)
#plot_stat_significance_nbAPR(normalized_number_APR_regions)

```

##Statistical tests and visualisation on secretory vs. non-secretory
```{r}
#plot_average_tango_scores_complete_proteins_joined_secreted() # Should be: ##plot_normalized_number_APR_regions_joined_secreted()
#significance_secretory_nbAPR(normalized_number_APR_regions)
#plot_stat_significance_nbAPR_secretory(normalized_number_APR_regions)

```


# Peptide charges

```{r}
source("charges.R")
classify_subsets()
```

```{r}
# TODO: make plots showing the differences between APR, GK and FR based on charges
# TODO: see if differences when split into subcellular locations

# protein_sequences_APR_peptides = get_charge(APR_peptides)
# protein_sequences_GK_peptides = get_charge(GK_peptides)
# protein_sequences_FR_peptides = get_charge(FR_peptides)
```

# Pie Plot for the residues

Lysine (Lys) --> K <br /> Arginine (Arg) --> R <br /> Aspartic acid (Asp) --> D <br /> Glutamic acid (Glu) --> E

```{r}
source("gatekeeper.R")
```

## Only for the GK regions

```{r}
GK_analysis = analyse_gate_keeper_regions()
```

PERCENTAGE OF ALL RESIDUES FOR ALL OF THE GK REGIONS IN ALL PROTEINS

```{r}
pie_plot_percentage_of_all_residues(GK_analysis$cts_gk, "GK REGIONS")
```

PERCENTAGE OF ALL RESIDUES FOR ALL OF THE GK + FL REGIONS IN ALL PROTEINS

```{r}
pie_plot_percentage_of_all_residues(GK_analysis$cts_gk_fl, "GK + FL REGIONS")
```

PERCENTAGE OF ALL GROUPS OF RESIDUES FOR ALL THE GK REGIONS IN ALL PROTEINS

```{r}
pie_plot_percentage_of_all_residues(GK_analysis$cts_gk_groups, "GK REGIONS")
```

PERCENTAGE OF ALL GROUPS OF RESIDUES FOR ALL THE GK + FL REGIONS IN ALL PROTEINS

```{r}
pie_plot_percentage_of_all_residues(GK_analysis$cts_gk_fl_groups, "GK REGIONS")
```

## Interested residues

Lysine (Lys) --> K <br /> Arginine (Arg) --> R <br /> Aspartic acid (Asp) --> D <br /> Glutamic acid (Glu) --> E <br /> Serine (Ser) --> S <br /> Proline (Pro) --> P <br /> PERCENTAGE OF INTERESTED RESIDUES FOR ALL OF THE GK REGIONS IN ALL PROTEINS

```{r}
GK_analysis_interested_aa = analyse_interested_gate_keeper_regions(GK_analysis)
```

```{r}
pie_plot_percentage_of_interested_residues(GK_analysis_interested_aa$cts_interest_gk, "GK REGIONS")
```

PERCENTAGE OF INTERESTED RESIDUES FOR ALL OF THE GK + FL REGIONS IN ALL PROTEINS

```{r}
pie_plot_percentage_of_interested_residues(GK_analysis_interested_aa$cts_interest_gk_fl, "GK + FL REGIONS")
```

PERCENTAGE OF INTERESTED RESIDUES FOR ALL OF THE GK SIDES

```{r}
GK_analysis_GK_residues = analyse_gate_keeper_residues(GK_analysis$cts_gk_side)
side_string = "GK"
```

```{r}
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$lys_ct, "LYS", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$arg_ct, "ARG", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$asp_ct, "ASP", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$glu_ct, "GLU", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$ser_ct, "SER", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_residues$pro_ct, "PRO", side_string)
```

PERCENTAGE OF INTERESTED RESIDUES FOR ALL OF THE GK + FL SIDES

```{r}
GK_analysis_GK_and_FL_residues = analyse_gate_keeper_residues(GK_analysis$cts_gk_fl_side)
side_string = "GK + FL"
```

```{r}
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$lys_ct, "LYS", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$arg_ct, "ARG", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$asp_ct, "ASP", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$glu_ct, "GLU", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$ser_ct, "SER", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_residues$pro_ct, "PRO", side_string)
```

##INTERESTED GROUPS Postive charged (positive) --> K <br /> Negative charged (negative) --> R <br /> Uncharged (uncharged) --> D <br /> Special cases (special) --> E <br /> Hydrophobic (hydrophobic) --> S <br /> PERCENTAGE OF INTERESTED GROUPS FOR ALL THE GK SIDES

```{r}
GK_analysis_GK_groups = analyse_gate_keeper_groups(GK_analysis$cts_gk_groups_side)
side_string = "GK"
```

```{r}
pie_plot_percentage_of_specific_residue(GK_analysis_GK_groups$positive, "positive charged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_groups$negative, "negative charged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_groups$uncharged, "uncharged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_groups$special, "special cases", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_groups$hydrophobic, "hydrophobic", side_string)
```

PERCENTAGE OF INTERESTED RESIDUES FOR ALL OF THE GK + FL SIDES

```{r}
GK_analysis_GK_and_FL_groups = analyse_gate_keeper_groups(GK_analysis$cts_gk_fl_groups_side)
side_string = "GK + FL"
```

```{r}
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_groups$positive, "positive charged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_groups$negative, "negative charged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_groups$uncharged, "uncharged", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_groups$special, "special cases", side_string)
pie_plot_percentage_of_specific_residue(GK_analysis_GK_and_FL_groups$hydrophobic, "hydrophobic", side_string)
```

## Subcellular location

Previous analyses are done for all of the proteins, but now we will be working on all the proteins that belong to a specific subcellular location

```{r}
# Statistics for each subcellular location
for (i in 1:length(search_terms)) {
  counts = get_counts_for_subcellular_location(search_terms[i], GK_analysis) # Takes a while to run
  
  residue_category = "all"
  pie_plot_subcellular_location(counts$cts_gk, residue_category, "GK", search_terms[i])
  pie_plot_subcellular_location(counts$cts_gk_groups, residue_category, "GK", search_terms[i])
  pie_plot_subcellular_location(counts$cts_gk_fl, residue_category, "GK + FL", search_terms[i])
  pie_plot_subcellular_location(counts$cts_gk_fl_groups, residue_category, "GK + FL", search_terms[i])
  
  # PERCENTAGE OF INTERESTED PROTEINS IN SUBCELLULAR LOCATIONS
  
  counts_interest <- analyse_interested_gate_keeper_regions(counts)
  residue_category = "interested"
  pie_plot_subcellular_location(counts_interest$cts_interest_gk, residue_category, "GK", search_terms[i])
  pie_plot_subcellular_location(counts_interest$cts_interest_gk_fl, residue_category, "GK + FL", search_terms[i])
  
  # NOW THE SIDES PART
  counts_side_gk <- analyse_sides(counts$cts_gk_side)
  counts_side_gk_fl <- analyse_sides(counts$cts_gk_fl_side)
  counts_side_gk_groups <- analyse_sides(counts$cts_gk_groups_side)
  counts_side_gk_fl_groups <- analyse_sides(counts$cts_gk_fl_groups_side)

  region_string = "GK"
  pie_plot_sides(counts_side_gk$lys_ct, "LYS", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk$arg_ct, "ARG", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk$asp_ct, "ASP", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk$glu_ct, "GLU", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk$ser_ct, "SER", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk$pro_ct, "PRO", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_groups$pos_ct, "positive", region_string, search_terms[i]) 
  pie_plot_sides(counts_side_gk_groups$neg_ct, "negative", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_groups$unc_ct, "uncharged", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_groups$spe_ct, "special cases", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_groups$hyd_ct, "hydrophobic", region_string, search_terms[i])
  
  region_string = "GK + FL"
  pie_plot_sides(counts_side_gk_fl$lys_ct, "LYS", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl$arg_ct, "ARG", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl$asp_ct, "ASP", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl$glu_ct, "GLU", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl$ser_ct, "SER", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl$pro_ct, "PRO", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl_groups$pos_ct, "positive", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl_groups$neg_ct, "negative", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl_groups$unc_ct, "uncharged", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl_groups$spe_ct, "special cases", region_string, search_terms[i])
  pie_plot_sides(counts_side_gk_fl_groups$hyd_ct, "hydrophobic", region_string, search_terms[i])
}
```
